<!DOCTYPE html>
<html lang="fr">

<head>
  <meta charset="UTF-8">
  <link rel="stylesheet" type="text/css" href="style.css" />
  <link rel="stylesheet" href="node_modules/spectre.css/dist/spectre.min.css">
  <link rel="stylesheet" href="node_modules/spectre.css/dist/spectre-exp.min.css">
  <link rel="stylesheet" href="node_modules/spectre.css/dist/spectre-icons.min.css">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <script src="index.js" type="text/javascript"></script>

  <title>
    Projet JS
  </title>
</head>

<body>
  <script>
    const root = document.querySelector('body');
    createElement('h1', { text: "Welcome on the website for the nft", color: '#627264', myclass: 'title' }, root);

    (async () => {
      async function dataFetching(url) {
        const raw = await fetch(url);
        const { assets } = await raw.json();
        return assets;
      }
      //create my main div
      createElement('div', { myclass: 'allentities' }, root);
      const allentities = document.getElementsByClassName('allentities')[0];
      let n = 0;
      try {
        const assets = await dataFetching("https://awesome-nft-app.herokuapp.com/")
        assets.map(({ name, image_url, id, creator, collection, sales }) => {
          //create Card
          createElement('div', { myclass: 'card' }, allentities);
          const card = document.getElementsByClassName('card')[n];

          //create div header
          createElement('div', { myclass: 'card-header' }, card);
          const cardHeader = document.getElementsByClassName('card-header')[n];

          //Create title and heart
          createElement('div', { myclass: 'titlenft' }, cardHeader);
          const titlenft = document.getElementsByClassName('titlenft')[n];
          createElement('h2', { text: name, color: '#627264', myclass: 'namenft' }, titlenft);
          createElement('a', {
            myclass: 'favorite', dataFavorite: id,
            dataFavoriteAddClass: 'favoriteadd', dataFavoriteRemoveClass: 'favoriteremove'
          }, titlenft);

          //create p username
          if (creator.username) {
            createElement('p', { text: `Created by ${creator.username} <br> On the ${collection.created_at.slice(0, 10)}`, myclass: 'card-subtitle text-gray' }, cardHeader);
          }
          else {
            createElement('p', { text: `Created by unknown Creator <br> On the ${collection.created_at.slice(0, 10)}`, myclass: 'card-subtitle text-gray' }, cardHeader);
          }

          //create p sales
          if (sales) {
            createElement('p', { text: `${sales} sales`, color: '#627264', myclass: 'card-subtitle' }, cardHeader);
          }
          else {
            createElement('p', { text: `0 sales`, color: '#627264', myclass: 'card-subtitle' }, cardHeader);
          }

          //create image
          if (image_url) {
            createElement('DIV', { myclass: 'card-image' }, card);
            const cardImage = document.getElementsByClassName('card-image')[n];
            createElement('img', { imgsrc: image_url, myclass: 'img-responsive image' }, cardImage);
          }

          //create btn
          createElement('div', { myclass: 'card-footer' }, cardHeader);
          const cardFooter = document.getElementsByClassName('card-footer')[n];
          createElement('button', { text: "Voir la fiche d√©tails", myonclick: `window.location.href='product.html?id=${id}'`, myclass: 'btn', color: '#627264', bgcolor: '#A1CDA8', border: '#A1CDA8' }, cardFooter);
          n++;
        })
      } catch (error) {
        console.log(error);
      }
      const datasLoadedEvent = new Event('datasLoaded')
      document.dispatchEvent(datasLoadedEvent)
    })();

  </script>
</body>


</html>